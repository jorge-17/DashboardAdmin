!function(a){a(window.jQuery,window,document)}(function($,window,document){const rootURL=sessionStorage.getItem("rootURL"),urlDashboard=sessionStorage.getItem("urlDashboard"),consultarReporte1="ObtenerReporte1",consultarReporte2="ObtenerReporte2",consultarReportePF="ReportePersonasFisicas",consultarReporteConce="ObtenerConcesionarios",obtenerCiudades="ConsultarCiudades",tokenSession=sessionStorage.getItem("token"),fechaNow=new Date,yearN=fechaNow.getFullYear(),monthN=fechaNow.getMonth(),dayN=fechaNow.getDate();var registrosRep=[],registrosRep2=[],table1,table2,table3,table4,flagTbl1,flagTbl2=!1,permisos=sessionStorage.getItem("permisos"),btns;function paddingDates(date){const pad="00",str=""+date;return pad.substring(0,pad.length-str.length)+str}async function cargaTablaReporte1(){$("#loader").show(),$("#loader_bkg").show();const fechaRep1=$("#dateRangePicker1").val();if(""!==fechaRep1){var dateRange=fechaRep1.split(" - "),dateInicial=dateRange[0],dateFinal=dateRange[1],dateFinalArr=dateFinal.split("/"),dataJson=JSON.stringify({token:tokenSession,fechaInit:dateInicial,fechaEnd:dateFinal}),resultado;try{resultado=await $.ajax({type:"POST",url:rootURL+consultarReporte1,data:dataJson,contentType:"application/json; charset=utf-8"})}catch(error){console.log(error)}$.when(resultado).then(function(data){$("#tablaReportes1 thead").show(),datos=JSON.parse(data.d),totRegRep=datos.iRegistros,TotalRegistros=totRegRep,registrosRep=datos.aoData;var cont=0;registrosRep.forEach(element=>{$("#TblRep1Body").append("<tr id='tblReporteFila"+cont+"'></tr>");const fila=$("#tblReporteFila"+cont);fila.append("<td>"+element.NumGafete+"</td>");var arrayFechaT=element.FechaTramite.split("T");fila.append("<td>"+arrayFechaT[0]+"</td>"),fila.append("<td>"+element.MotivoIncompleto+"</td>"),fila.append("<td>"+element.Ubicacion+"</td>"),fila.append("<td>"+element.NombreCompleto+"</td>");var arrayFechaN=element.FechaNacimiento.split("T");fila.append("<td>"+arrayFechaN[0]+"</td>"),fila.append("<td>"+element.Modalidad+"</td>"),fila.append("<td>"+element.Descripcion+"</td>"),fila.append("<td>"+element.AniosGafete+"</td>");var arrayFechaTG=element.FechaExpedicionGafete.split("T");fila.append("<td>"+arrayFechaTG[0]+"</td>"),fila.append("<td>"+element.AniosLicencia+"</td>"),fila.append("<td>"+element.TipoLicencia+"</td>"),fila.append("<td>"+element.Nombre+"</td>"),fila.append("<td>"+element.IdLinea+"</td>"),fila.append("<td>"+element.Clave+"</td>"),fila.append("<td>"+element.LineaNombre+"</td>"),fila.append("<td>"+element.Concesiones+"</td>"),cont++}),table1=$("#tablaReportes1").DataTable({dom:"Bfrtlip",buttons:["excel"],scrollX:!0}),flagTbl1=!0,table1.column(2).visible(!1),table1.column(3).visible(!1),table1.column(5).visible(!1),table1.column(8).visible(!1),table1.column(9).visible(!1),table1.column(10).visible(!1),table1.column(11).visible(!1),table1.column(12).visible(!1),table1.column(13).visible(!1),table1.column(14).visible(!1),table1.column(15).visible(!1),table1.column(16).visible(!1),$("#loader").hide(),$("#loader_bkg").hide()})}}async function cargaTablaReporte2(){$("#loader").show(),$("#loader_bkg").show();const fechaRep2=$("#dateRangePicker2 input").val();if(""!==fechaRep2){var dateRange=fechaRep2.split(" - "),dateInicial=dateRange[0],dateFinal=dateRange[1],dateFinalArr=dateFinal.split("/"),dataJson=JSON.stringify({token:tokenSession,fechaInit:dateInicial,fechaEnd:dateFinal}),resultado;try{resultado=await $.ajax({type:"POST",url:rootURL+consultarReporte2,data:dataJson,contentType:"application/json; charset=utf-8"})}catch(error){console.log(error)}return $.when(resultado).then(function(data){$("#tablaReportes2 thead").show(),resultado=data,datos=JSON.parse(data.d),totRegRep=datos.iRegistros,TotalRegistros=totRegRep,registrosRep2=datos.aoData;var cont=0;registrosRep2.forEach(element=>{var tt=parseInt(element.IdTipoTramite);$("#TblRep2Body").append("<tr id='tblReporteFila"+cont+"'></tr>");const fila=$("#tblReporteFila"+cont);fila.append("<td>"+element.NoGafete+"</td>"),fila.append("<td>"+element.IdTramiteExpediente+"</td>");var fechaTramite=element.FechaTramite.split("-"),cadena;if(fila.append("<td>"+paddingDates(fechaTramite[2])+"/"+paddingDates(fechaTramite[1])+"/"+fechaTramite[0]+"</td>"),fila.append("<td>"+element.TramiteRealizado+"</td>"),cadena=null==element.AniosTipos?"":element.AniosTipos.split("|"),tt<6){const fechat=new Date(element.FechaTramite);if(""!==cadena)if(4===tt||5===tt)var tipo=cadena[0].split(","),anio="",fvl="";else var anios=cadena[0].split(","),anio=parseInt(anios[1]),tipo=cadena[1].split(","),fvl=paddingDates(fechat.getDate())+"/"+paddingDates(fechat.getMonth()+1)+"/"+(fechat.getFullYear()+anio);else var anio="",tipo=["",""],fvl="";fila.append("<td>"+anio+"</td>"),fila.append("<td>"+tipo[1]+"</td>"),fila.append("<td>"+fvl+"</td>"),fila.append("<td></td>"),fila.append("<td></td>"),fila.append("<td></td>")}else{if(""!==cadena)if(9===tt||10===tt||11===tt){var anio="",fechaV=cadena[0].split(","),dateVG;(dateVG=[])[0]=fechaV[1],"dd/MM/yyyy"===dateVG[0]?dateVG[0]="":dateVG[0];var anioV=fechaV[1].split("/"),fechaX=new Date(anioV[2],anioV[1],anioV[0]),fvl=""}else{var anios=cadena[0].split(","),anio=parseInt(anios[1]),Vgafete=[""];if(void 0!==cadena[1])var Vgafete=cadena[1].split(",");var dateVG,anioV=(dateVG=Vgafete[1].split(" "))[0].split("/"),fechaX=new Date(anioV[2],anioV[1],anioV[0]),fvl=anioV[0]+"/"+anioV[1]+"/"+(parseInt(anioV[2])-anio)}else var anio="",dateVG=[""],fvl="";fila.append("<td></td>"),fila.append("<td></td>"),fila.append("<td></td>"),fila.append("<td>"+anio+"</td>"),fila.append("<td>"+dateVG[0]+"</td>"),fila.append("<td>"+fvl+"</td>")}fila.append("<td>"+element.Nombres+"</td>"),fila.append("<td>"+element.ApellidoPaterno+"</td>"),fila.append("<td>"+element.ApellidoMaterno+"</td>");var fToxi=element.FechaToxicologico,valor;if(void 0===fToxi[0])var stringv="";else if(null==(valor=fToxi[0].FechaExpedicion))var stringv="";else{var arrValor=valor.split("T");if("1999-10-03"===arrValor[0])var stringv="";else var stringv=(valor=arrValor[0].split("-"))[2]+"/"+valor[1]+"/"+valor[0]}fila.append("<td>"+stringv+"</td>"),fila.append("<td>"+element.MunicipioAdscripcion+"</td>");var valFN="//"===element.FechaNacimiento?"":element.FechaNacimiento;fila.append("<td>"+valFN+"</td>"),fila.append("<td>"+element.Clave+"</td>"),fila.append("<td>"+element.Linea+"</td>"),fila.append("<td>"+element.Modalidad+"</td>"),fila.append("<td>"+element.Concesiones+"</td>"),fila.append("<td>"+element.Usuario+"</td>"),cont++}),btns=permisos.includes("DSB003")?[{extend:"excelHtml5",title:"Reporte Transparencia"}]:[],table2=$("#tablaReportes2").DataTable({dom:"Bfrtlip",buttons:btns,scrollX:!0}),$(".dt-button").addClass("btn btn-info"),flagTbl2=!0,table2.column(14).visible(!1),table2.column(15).visible(!1),table2.column(16).visible(!1),table2.column(17).visible(!1),table2.column(18).visible(!1),table2.column(20).visible(!1),$("#loader").hide(),$("#loader_bkg").hide()}),resultado}}async function cargaTablaReportePersonasFisicas(){$("#loader").show(),$("#loader_bkg").show();const idModalidad=$("#selModalidades").val();if(""!==idModalidad){var dataJson=JSON.stringify({token:tokenSession,idModalidad:idModalidad}),resultado;try{resultado=await $.ajax({type:"POST",url:rootURL+consultarReportePF,data:dataJson,contentType:"application/json; charset=utf-8"})}catch(error){console.log(error)}$.when(resultado).done(function(data){$("#tablaReportesPF thead").show();var datos,pFisicias=JSON.parse(data.d).aoData,cont=0;pFisicias.forEach(element=>{var fila=$("<tr></tr>").attr("id","tblReporPF0");$("#TblRepPFBody").append(fila),fila.append("<td>"+element.Nombres+"</td>"),fila.append("<td>"+element.ApellidoPaterno+"</td>"),fila.append("<td>"+element.ApellidoMaterno+"</td>");var sexo=null===element.Sexo?"-":element.Sexo;fila.append("<td>"+sexo+"</td>"),fila.append("<td>"+element.Descripcion+"</td>"),fila.append("<td>"+element.Nacionalidad+"</td>");var curp=null===element.CURP?"-":element.CURP;fila.append("<td>"+curp+"</td>");var rfc=null===element.RFC?"-":element.RFC;fila.append("<td>"+rfc+"</td>");var calle=null===element.Calle?"":element.Calle,noExt=null===element.NumeroExterior?"":element.NumeroExterior,colonia=null===element.Colonia?"":element.Colonia;fila.append("<td>"+calle+" "+noExt+" "+colonia+"</td>"),fila.append("<td>"+element.noEconomico+"</td>")}),btns=permisos.includes("DSB003")?[{extend:"excelHtml5",title:"Reporte Personas Fisicas"}]:[],table3=$("#tablaReportesPF").DataTable({dom:"Bfrtlip",buttons:btns}),$("#loader").hide(),$("#loader_bkg").hide()})}}async function cargaTablaReporteConcesionarios(){$("#loader").show(),$("#loader_bkg").show();const idModalidad=$("#selModalidadesConce").val(),idCiudad=$("#selCiudades").val();if(""!==idModalidad){var dataJson=JSON.stringify({token:tokenSession,idModalidad:idModalidad,MunAdscipcion:idCiudad}),resultado;try{resultado=await $.ajax({type:"POST",url:rootURL+consultarReporteConce,data:dataJson,contentType:"application/json; charset=utf-8"})}catch(error){console.log(error)}$.when(resultado).done(function(data){$("#tablaReportesConce thead").show();var datos,pFisicias=JSON.parse(data.d).aoData,cont=0;pFisicias.forEach(element=>{var fila=$("<tr></tr>").attr("id","tblReporteConce0");$("#TblRepConceBody").append(fila),fila.append("<td>"+element.Nombres+"</td>"),fila.append("<td>"+element.ApellidoPaterno+"</td>"),fila.append("<td>"+element.ApellidoMaterno+"</td>");var sexo=null===element.Sexo?"-":element.Sexo;sexo="h"===sexo?"Hombre":"m"===sexo?"Mujer":"Otro",fila.append("<td>"+sexo+"</td>"),fila.append("<td>"+element.EdoCivil+"</td>"),fila.append("<td>"+element.ClaveElector+"</td>"),fila.append("<td>"+element.Nacionalidad+"</td>");var curp=null===element.CURP?"-":element.CURP;fila.append("<td>"+curp+"</td>");var fechaNac,fN=(null===element.FechaNacimiento?["-"]:element.FechaNacimiento.split("T"))[0].split("-");fila.append("<td>"+fN[2]+"/"+fN[1]+"/"+fN[0]+"</td>");var ciudad=null===element.Nombre?"":element.Nombre;fila.append("<td>"+ciudad+"</td>");var tipoCasa=null===element.Descripcion?"":element.Descripcion;fila.append("<td>"+tipoCasa+"</td>");var noEconomico=null===element.IdSCT?"":element.IdSCT;fila.append("<td>"+noEconomico+"</td>");var noConcesion=null===element.NoConcesion?"":element.NoConcesion;fila.append("<td>"+noConcesion+"</td>")}),btns=permisos.includes("DSB003")?[{extend:"excelHtml5",title:"Reporte Concesionarios"}]:[],table4=$("#tablaReportesConce").DataTable({dom:"Bfrtlip",buttons:btns,language:{lengthMenu:"Mostrar _MENU_ concesionarios por pagina",zeroRecords:"No se encontraros concesionarios",info:"Mostrando pagina _PAGE_ de _PAGES_",infoEmpty:"No se encontraros concesionarios",infoFiltered:"(filtradas de _MAX_ total de concesionarios)",paginate:{first:"Primero",last:"Último",next:"Siguiente",previous:"Anterior"},search:"Buscar:"}}),$("#loader").hide(),$("#loader_bkg").hide()})}}async function cargaCiudades(idEstado){var resultado;$("#selCiudades").empty().append('<option value="">Seleccione la ciudad</option>');try{resultado=await $.ajax({type:"POST",url:rootURL+obtenerCiudades,data:JSON.stringify({token:tokenSession,idEstado:idEstado}),contentType:"application/json; charset=utf-8"})}catch(error){console.log(error)}$.when(resultado).then(function(data){datos=JSON.parse(data.d),totRegCR=datos.iRegistros,setTimeout(function(){for(var i=0;i<totRegCR;i++){const item=datos.aoData[i],idCiudad=item.IdCiudad,nombreCiudad=item.Nombre;$("#selCiudades").append('<option value="'+idCiudad+'">'+nombreCiudad+"</option>")}},300)})}$("#dateRangePicker1").daterangepicker({maxDate:monthN+1+"/"+dayN+"/"+yearN,autoUpdateInput:!1,locale:{cancelLabel:"Limpiar"}}),$("#dateRangePicker2").daterangepicker({maxDate:monthN+1+"/"+dayN+"/"+yearN,autoUpdateInput:!1,locale:{applyLabel:"Aplicar",cancelLabel:"Cancelar",fromLabel:"De",toLabel:"A",daysOfWeek:["Dom.","Lun.","Mar.","Mie.","Jue.","Vie.","Sab."],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agusto","Septiembre","Octubre","Noviembre","Diciembre"]}}),$('input[name="dateRangePicker1"]').on("apply.daterangepicker",function(ev,picker){$(this).val(picker.startDate.format("DD/MM/YYYY")+" - "+picker.endDate.format("DD/MM/YYYY")),$.fn.dataTable.isDataTable("#tablaReportes1")&&(table1.destroy(),$("#TblRep1Body").empty()),cargaTablaReporte1()}),$("#dateRangePicker2").on("apply.daterangepicker",function(ev,picker){$("#dateRangePicker2 input").val(picker.startDate.format("DD/MM/YYYY")+" - "+picker.endDate.format("DD/MM/YYYY")),$.fn.dataTable.isDataTable("#tablaReportes2")&&(table2.destroy(),$("#TblRep2Body").empty()),cargaTablaReporte2()}),$("#selModalidades").on("change",function(){$.fn.dataTable.isDataTable("#tablaReportesPF")&&(table3.destroy(),$("#TblRepPFBody").empty()),cargaTablaReportePersonasFisicas()}),$("#selCiudades").on("change",function(){$.fn.dataTable.isDataTable("#tablaReportesConce")&&(table4.destroy(),$("#TblRepConceBody").empty()),cargaTablaReporteConcesionarios()}),$(window).on("load",function(){cargaCiudades(24)})});