!function(a){a(window.jQuery,window,document)}(function($,window,document){const rootURL="https://wsi01.sctslp.gob.mx/wcf/Dashboard.svc/",consultarReporte1="ObtenerReporte1",consultarReporte2="ObtenerReporte2",tokenSession=sessionStorage.getItem("token"),fechaNow=new Date,yearN=fechaNow.getFullYear(),monthN=fechaNow.getMonth(),dayN=fechaNow.getDate();var registrosRep=[],registrosRep2=[],table1,table2,flagTbl1,flagTbl2=!1;function paddingDates(date){const pad="00",str=""+date;return pad.substring(0,pad.length-str.length)+str}async function cargaTablaReporte1(){const fechaRep1=$("#dateRangePicker1").val();if(""!==fechaRep1){var dateRange=fechaRep1.split(" - "),dateInicial=dateRange[0],dateFinal=dateRange[1],dateFinalArr=dateFinal.split("/"),dataJson=JSON.stringify({token:tokenSession,fechaInit:dateInicial,fechaEnd:dateFinal}),resultado;try{resultado=await $.ajax({type:"POST",url:rootURL+consultarReporte1,data:dataJson,contentType:"application/json; charset=utf-8"})}catch(error){console.log(error)}$.when(resultado).then(function(data){$("#tablaReportes1 thead").show(),datos=JSON.parse(data.d),totRegRep=datos.iRegistros,TotalRegistros=totRegRep,registrosRep=datos.aoData;var cont=0;registrosRep.forEach(element=>{$("#TblRep1Body").append("<tr id='tblReporteFila"+cont+"'></tr>");const fila=$("#tblReporteFila"+cont);fila.append("<td>"+element.NumGafete+"</td>");var arrayFechaT=element.FechaTramite.split("T");fila.append("<td>"+arrayFechaT[0]+"</td>"),fila.append("<td>"+element.MotivoIncompleto+"</td>"),fila.append("<td>"+element.Ubicacion+"</td>"),fila.append("<td>"+element.NombreCompleto+"</td>");var arrayFechaN=element.FechaNacimiento.split("T");fila.append("<td>"+arrayFechaN[0]+"</td>"),fila.append("<td>"+element.Modalidad+"</td>"),fila.append("<td>"+element.Descripcion+"</td>"),fila.append("<td>"+element.AniosGafete+"</td>");var arrayFechaTG=element.FechaExpedicionGafete.split("T");fila.append("<td>"+arrayFechaTG[0]+"</td>"),fila.append("<td>"+element.AniosLicencia+"</td>"),fila.append("<td>"+element.TipoLicencia+"</td>"),fila.append("<td>"+element.Nombre+"</td>"),fila.append("<td>"+element.IdLinea+"</td>"),fila.append("<td>"+element.Clave+"</td>"),fila.append("<td>"+element.LineaNombre+"</td>"),fila.append("<td>"+element.Concesiones+"</td>"),cont++}),table1=$("#tablaReportes1").DataTable({dom:"Bfrtlip",buttons:["excel"],scrollX:!0}),flagTbl1=!0,table1.column(2).visible(!1),table1.column(3).visible(!1),table1.column(5).visible(!1),table1.column(8).visible(!1),table1.column(9).visible(!1),table1.column(10).visible(!1),table1.column(11).visible(!1),table1.column(12).visible(!1),table1.column(13).visible(!1),table1.column(14).visible(!1),table1.column(15).visible(!1),table1.column(16).visible(!1)})}}async function cargaTablaReporte2(){const fechaRep2=$("#dateRangePicker2").val();if(""!==fechaRep2){var dateRange=fechaRep2.split(" - "),dateInicial=dateRange[0],dateFinal=dateRange[1],dateFinalArr=dateFinal.split("/"),dataJson=JSON.stringify({token:tokenSession,fechaInit:dateInicial,fechaEnd:dateFinal}),resultado;try{resultado=await $.ajax({type:"POST",url:rootURL+consultarReporte2,data:dataJson,contentType:"application/json; charset=utf-8"})}catch(error){console.log(error)}return $.when(resultado).then(function(data){$("#tablaReportes2 thead").show(),resultado=data,datos=JSON.parse(data.d),totRegRep=datos.iRegistros,TotalRegistros=totRegRep,registrosRep2=datos.aoData;var cont=0;registrosRep2.forEach(element=>{var tt=parseInt(element.IdTipoTramite);$("#TblRep2Body").append("<tr id='tblReporteFila"+cont+"'></tr>");const fila=$("#tblReporteFila"+cont);fila.append("<td>"+element.NoGafete+"</td>"),fila.append("<td>"+element.IdTramiteExpediente+"</td>");var fechaTramite=element.FechaTramite.split("-"),cadena;if(fila.append("<td>"+paddingDates(fechaTramite[2])+"/"+paddingDates(fechaTramite[1])+"/"+fechaTramite[0]+"</td>"),fila.append("<td>"+element.TramiteRealizado+"</td>"),cadena=null==element.AniosTipos?"":element.AniosTipos.split("|"),tt<6){const fechat=new Date(element.FechaTramite);if(""!==cadena)if(4===tt||5===tt)var tipo=cadena[0].split(","),anio="",fvl="";else var anios=cadena[0].split(","),anio=parseInt(anios[1]),tipo=cadena[1].split(","),fvl=paddingDates(fechat.getDate())+"/"+paddingDates(fechat.getMonth()+1)+"/"+(fechat.getFullYear()+anio);else var anio="",tipo=["",""],fvl="";fila.append("<td>"+anio+"</td>"),fila.append("<td>"+tipo[1]+"</td>"),fila.append("<td>"+fvl+"</td>"),fila.append("<td></td>"),fila.append("<td></td>"),fila.append("<td></td>")}else{if(""!==cadena)if(9===tt||10===tt||11===tt){var anio="",fechaV=cadena[0].split(","),dateVG;(dateVG=[])[0]=fechaV[1],"dd/MM/yyyy"===dateVG[0]?dateVG[0]="":dateVG[0];var anioV=fechaV[1].split("/"),fechaX=new Date(anioV[2],anioV[1],anioV[0]),fvl=""}else{var anios=cadena[0].split(","),anio=parseInt(anios[1]),Vgafete=[""];if(void 0!==cadena[1])var Vgafete=cadena[1].split(",");var dateVG,anioV=(dateVG=Vgafete[1].split(" "))[0].split("/"),fechaX=new Date(anioV[2],anioV[1],anioV[0]),fvl=anioV[0]+"/"+anioV[1]+"/"+(parseInt(anioV[2])-anio)}else var anio="",dateVG=[""],fvl="";fila.append("<td></td>"),fila.append("<td></td>"),fila.append("<td></td>"),fila.append("<td>"+anio+"</td>"),fila.append("<td>"+dateVG[0]+"</td>"),fila.append("<td>"+fvl+"</td>")}fila.append("<td>"+element.Nombres+"</td>"),fila.append("<td>"+element.ApellidoPaterno+"</td>"),fila.append("<td>"+element.ApellidoMaterno+"</td>");var fToxi=element.FechaToxicologico,valor;if(void 0===fToxi[0])var stringv="";else if(null==(valor=fToxi[0].FechaExpedicion))var stringv="";else{var arrValor=valor.split("T");if("1999-10-03"===arrValor[0])var stringv="";else var stringv=(valor=arrValor[0].split("-"))[2]+"/"+valor[1]+"/"+valor[0]}fila.append("<td>"+stringv+"</td>"),fila.append("<td>"+element.MunicipioAdscripcion+"</td>");var valFN="//"===element.FechaNacimiento?"":element.FechaNacimiento;fila.append("<td>"+valFN+"</td>"),fila.append("<td>"+element.Clave+"</td>"),fila.append("<td>"+element.Linea+"</td>"),fila.append("<td>"+element.Modalidad+"</td>"),fila.append("<td>"+element.Concesiones+"</td>"),fila.append("<td>"+element.Usuario+"</td>"),cont++}),table2=$("#tablaReportes2").DataTable({dom:"Bfrtlip",buttons:["excel"],scrollX:!0}),flagTbl2=!0,table2.column(14).visible(!1),table2.column(15).visible(!1),table2.column(16).visible(!1),table2.column(17).visible(!1),table2.column(18).visible(!1),table2.column(20).visible(!1)}),resultado}}$("#dateRangePicker1").daterangepicker({maxDate:monthN+1+"/"+dayN+"/"+yearN,autoUpdateInput:!1,locale:{cancelLabel:"Clear"}}),$("#dateRangePicker2").daterangepicker({maxDate:monthN+1+"/"+dayN+"/"+yearN,autoUpdateInput:!1,locale:{cancelLabel:"Clear"}}),$('input[name="dateRangePicker1"]').on("apply.daterangepicker",function(ev,picker){$(this).val(picker.startDate.format("DD/MM/YYYY")+" - "+picker.endDate.format("DD/MM/YYYY")),$.fn.dataTable.isDataTable("#tablaReportes1")&&(table1.destroy(),$("#TblRep1Body").empty()),cargaTablaReporte1()}),$('input[name="dateRangePicker2"]').on("apply.daterangepicker",function(ev,picker){$(this).val(picker.startDate.format("DD/MM/YYYY")+" - "+picker.endDate.format("DD/MM/YYYY")),$.fn.dataTable.isDataTable("#tablaReportes2")&&(table2.destroy(),$("#TblRep2Body").empty()),cargaTablaReporte2()})});