!function(a){a(window.jQuery,window,document)}(function($,window,document){const rootURL="https://wsi01.sctslp.gob.mx/wcf/Dashboard.svc/",GuardarPFfile="GuardarPersonaFisicaFile",obtenerExpedientes="ObtenerExpedientes",tokenSession=sessionStorage.getItem("token"),NombreUsuario=sessionStorage.getItem("NombreU");var resultado,tablaOperadores,validateFront=function(fromName){!0===$(".formDivExp").parsley().isValid()?($(".bs-callout-info").removeClass("hidden"),$(".bs-callout-warning").addClass("hidden"),$(".alertaVali").hide()):($(".bs-callout-info").addClass("hidden"),$(".bs-callout-warning").removeClass("hidden"),$(".alertaVali").show())};async function cargaTablaOperadores(){$("#loader").show(),$("#loader_bkg").show();var inputTexto=$("#inputBusqueda").val();if(""!==inputTexto){var dataJson=JSON.stringify({token:tokenSession,textoBus:inputTexto,idPrestadorServicio:0}),resultado;try{resultado=await $.ajax({type:"POST",url:rootURL+obtenerExpedientes,data:dataJson,contentType:"application/json; charset=utf-8"})}catch(e){console.log(e.message)}$.when(resultado).done(function(data){var datos,usuarios=JSON.parse(data.d).aoData,contador=0;usuarios.forEach(usuario=>{$("#tablaExpOperadores").append("<tr id='tblExOpRow"+contador+"'></tr>");const fila=$("#tblExOpRow"+contador);fila.append("<td style='display: none;'>"+usuario.IdExpediente+"</td>"),fila.append("<td style='display: none;'>"+usuario.IdPrestadorServicio+"</td>"),fila.append("<td>"+usuario.IdSCT+"</td>"),fila.append("<td>"+usuario.NombreCompleto+"</td>");var fechaCreacion=null==usuario.FechaCreacion?["-"]:usuario.FechaCreacion.split("T");fila.append("<td>"+fechaCreacion[0]+"</td>");var MunAds=null==usuario.MunAds?"":usuario.MunAds;fila.append("<td>"+MunAds[0]+"</td>");var curp=null==usuario.CURP?"-":usuario.CURP;fila.append("<td>"+curp+"</td>");var rfc=null==usuario.RFC?"-":usuario.RFC,suspendido;fila.append("<td>"+rfc+"</td>"),0==usuario.Suspendido?fila.append("<td><button id='btnSuspencion' class='btn btn-success'><i class='fas fa-lock-open'></i></button></td>"):fila.append("<td><button id='btnActivacion' class='btn btn-danger'><i class='fas fa-lock'></i></button></td>"),fila.append("<td style='display: none;'>"+usuario.ModalidadDesc+"</td>"),contador++}),tablaOperadores=$("#tablaExpOperadores").DataTable({dom:"p"})})}$("#loader").hide(),$("#loader_bkg").hide()}$("#btnBuscarExp").on("click",function(){$.fn.dataTable.isDataTable("#tablaExpOperadores")&&(tablaOperadores.destroy(),$("#TblCatBodyExpOperadores").empty()),cargaTablaOperadores()}),$("#tablaExpOperadores").on("click","#btnSuspencion",function(){$(".formDivExp").find("input[type=file], textarea").val(""),$("#modalLarge").modal("toggle"),$("#formularioDivExp").show(),$(".lblMovimiento").html("Suspensi贸n");var parent,child=$(this).parent("td").parent("tr").children("td"),idSCT=child[2].innerText,modalidad=child[9].innerText,nombre=child[3].innerText,idPrestador=child[1].innerText,idExpediente=child[0].innerText,idDocumentoSuspencion="00117";localStorage.setItem("values",idPrestador+"_"+idExpediente+"_00117_0"),$("#lbl_IdSCT").html(idSCT),$("#lbl_Modalidad").html(modalidad),$("#lbl_nombre").html(nombre)}),$("#tablaExpOperadores").on("click","#btnActivacion",function(){$(".formDivExp").find("input[type=file], textarea").val(""),$("#modalLarge").modal("toggle"),$("#formularioDivExp").show(),$(".lblMovimiento").html("Activaci贸n");var parent,child=$(this).parent("td").parent("tr").children("td"),idSCT=child[2].innerText,modalidad=child[9].innerText,nombre=child[3].innerText,idPrestador=child[1].innerText,idExpediente=child[0].innerText,idDocumentoActivacion="00118";localStorage.setItem("values",idPrestador+"_"+idExpediente+"_00118_1"),$("#lbl_IdSCT").html(idSCT),$("#lbl_Modalidad").html(modalidad),$("#lbl_nombre").html(nombre)}),$("#tablaCatalogos").on("click","#btnSuspencion",function(){$(".formDivExp").find("input[type=file], textarea").val(""),$("#formSuspencion").show(),$("#tablaPFdiv").hide(),$("#formularioDiv").hide(),$("#fromularioNuevaPF").hide(),$("#btnSaveDataCon").hide(),$(".lblMovimiento").html("Suspensi贸n");var parent,child=$(this).parent("td").parent("tr").children("td"),idSCT=child[2].innerText,modalidad=child[13].innerText,nombre=child[4].innerText,idPrestador=child[0].innerText,idExpediente=child[1].innerText,idDocumentoSuspencion="00117";localStorage.setItem("values",idPrestador+"_"+idExpediente+"_00117_0"),$(".lbl_IdSCT").html(idSCT),$(".lbl_Modalidad").html(modalidad),$(".lbl_nombre").html(nombre)}),$("#tablaCatalogos").on("click","#btnActivacion",function(){$(".formDivExp").find("input[type=file], textarea").val(""),$("#modalLarge").modal("toggle"),$("#formularioDiv").hide(),$("#btnSaveData").hide(),$("#btnSaveDataCon").hide(),$("#fromularioNuevaPF").hide(),$("#tablaPFdiv").hide(),$("#btnGuardarPJ").hide(),$("#btnRegresarBPF").hide(),$("#btnAgregarPF").hide(),$("#btnAgregarPFCon").hide(),$("#btnNuevaPF").hide(),$("#formSuspencion").show(),$(".lblMovimiento").html("Activaci贸n");var parent,child=$(this).parent("td").parent("tr").children("td"),idSCT=child[2].innerText,modalidad=child[13].innerText,nombre=child[4].innerText,idPrestador=child[0].innerText,idExpediente=child[1].innerText,idDocumentoActivacion="00118";localStorage.setItem("values",idPrestador+"_"+idExpediente+"_00118_1"),$(".lbl_IdSCT").html(idSCT),$(".lbl_Modalidad").html(modalidad),$(".lbl_nombre").html(nombre)}),$(".btnSaveDataExp").on("click",function(){if($(".formDivExp").parsley().validate(),validateFront(),!0===$(".formDivExp").parsley().isValid()){var values,valuesArr=localStorage.getItem("values").split("_");$("#modalLarge").modal("toggle");for(var files=$("#fileupload").get(0).files,formData=new FormData,i=0,resultado;i<files.length;i++)formData.append(valuesArr[2],files[i]);formData.append("motivo",$(".txt_motivo").val()),formData.append("token",sessionStorage.getItem("token")),formData.append("idPrestador",valuesArr[0]),formData.append("idExpediente",valuesArr[1]),formData.append("movimiento",valuesArr[3]);try{resultado=$.ajax({type:"POST",url:rootURL+GuardarPFfile,data:formData,contentType:!1,processData:!1})}catch(e){console.log(e.message)}$.when(resultado).done(function(data){var datos,info=JSON.parse(data.d).aoData;"x0004"===info?PNotify.notice({title:"Error x0004",text:"No se puede guardar se puede guardar el archivo que intentaste subir",styling:"bootstrap4",delay:4e3}):"x0002"===info?PNotify.notice({title:"Error x0002",text:"No se puede guardar la relacion que intentaste crear ...",styling:"bootstrap4",delay:4e3}):(console.log(info),PNotify.success({title:"Exito",text:"Se ha guardado la informacion correctamente.",styling:"bootstrap4",delay:2e3}),$.fn.dataTable.isDataTable("#tablaExpOperadores")&&(tablaOperadores.destroy(),$("#TblCatBodyExpOperadores").empty()),cargaTablaOperadores())})}})});